# Prompt 修复说明

## 问题

用户提问："对于我这个销售额，我有什么提高消费额的方法？"

AI 返回了看似专业的分析，但完全没有查询数据库，内容都是编造的：
- 提到了"笔记本电脑、手机、平板电脑"
- 提到了"华东、华北地区"
- 各种通用的营销建议

这些与实际 SQL 数据库（Chinook 音乐商店数据）毫无关系。

## 原因

原来的 Prompt 太宽松，Agent 认为开放式问题可以不查数据直接回答。

## 修复

### 1. 强化任务描述

**修改前：**
```python
你的任务：
1. 使用 nl2sql 工具将问题转换为 SQL 查询
2. 使用 sql_query_md 工具执行查询
3. 返回 Markdown 格式的数据表格
```

**修改后：**
```python
重要：必须从数据库中查询实际数据，不能凭空回答。

执行步骤：
1. 使用 get_database_schema() 查看数据库表结构
2. 使用 nl2sql() 将问题转换为 SQL 查询
3. 使用 sql_query_md() 执行 SQL 并获取结果
4. 返回 Markdown 格式的数据表格

禁止行为：
- 不查询数据库就直接回答
- 编造虚假数据
- 给出没有数据支撑的建议
```

### 2. 更新 Agent Backstory

强调核心原则：必须查询真实数据，不能凭空回答。

### 3. 修改的文件

- `crew.py` - 所有 3 个任务的描述
- `agents/data_engineer.py` - Agent backstory

## 测试

重启服务后，再次提问应该：
1. 先查询数据库 schema
2. 生成 SQL 查询
3. 执行查询获取真实数据
4. 报告包含真实的数据表格
5. 洞察引用具体数字

在 API 日志中应该看到：
```
[DataEngineer] 使用工具: get_database_schema
[DataEngineer] 使用工具: nl2sql
[DataEngineer] 使用工具: sql_query_md
```

## 核心原则

- 明确要求 > 隐含期望
- 禁止行为 > 允许自由发挥
- 强制流程 > 建议流程
- 真实数据 > 通用建议
